name: ðŸŽ‰ Release Binary - websiteSimilar

on:
  push:
    tags:
      - '*'
  workflow_dispatch:
  
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: "Check out code"
        uses: actions/checkout@v3
        with: 
          fetch-depth: 0

      - name: "Set up Go"
        uses: actions/setup-go@v5
        with: 
          go-version: '1.23'
          cache: false

      # Force garble to be built by the same Go version as the release build.
      # This avoids picking up a preinstalled/cached garble built with an older Go.
      - name: "Prepare local bin (outside repo)"
        run: |
          # Put binaries in RUNNER_TEMP to avoid making the git workspace dirty.
          echo "GOBIN=${RUNNER_TEMP}/bin" >> "$GITHUB_ENV"
          echo "${RUNNER_TEMP}/bin" >> "$GITHUB_PATH"

      # NOTE: pin garble to a version compatible with Go 1.23.
      - name: "Install garble"
        run: |
          go env
          go install mvdan.cc/garble@v0.12.1
          which garble
          garble -h >/dev/null
          
      - name: "Create release on GitHub"
        uses: goreleaser/goreleaser-action@v5
        with: 
          args: "release --clean"
          version: v2.12.7
          workdir: .
        env: 
          GITHUB_TOKEN: "${{ secrets.GO_BUILD_TOKEN }}"